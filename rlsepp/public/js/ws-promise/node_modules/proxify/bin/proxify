#!/usr/bin/env node

var cluster = require('cluster')
var fs = require('fs')
var path = require('path')


var configFile = path.resolve(process.argv[2] || 'config.json')
var config = require(configFile)

if(cluster.isMaster && config.prefork){
  for(var i = 0 ; i < config.prefork ; i++)
    cluster.fork()
} else {
  var SimpleProxy = require('../')
  var proxy = new SimpleProxy(config, configFile)
  config.watchConfig && proxy.watchConfig(configFile)
  proxy.listen()
}

/* vim: ft=javascript
*/
